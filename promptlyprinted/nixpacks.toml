[settings]
providers = ["node"]

[phases.setup]
nixPkgs = ["nodejs_22", "pnpm", "python3"]

[phases.install]
cmds = [
  "corepack enable",
  "pnpm install --frozen-lockfile"
]

[profiles.web.phases.build]
cmds = ["NODE_OPTIONS='--max-old-space-size=4096' pnpm --filter web build"]

[profiles.web.start]
cmd = "pnpm --filter web start"

[profiles.web.env]
PORT = "3000"

[profiles.app.phases.build]
cmds = ["NODE_OPTIONS='--max-old-space-size=4096' pnpm --filter app build"]

[profiles.app.start]
cmd = "pnpm --filter app start"

[profiles.app.env]
PORT = "3000"

[profiles.api.phases.build]
cmds = ["NODE_OPTIONS='--max-old-space-size=4096' pnpm --filter api build"]

[profiles.api.start]
cmd = "pnpm --filter api start"

[profiles.api.env]
PORT = "3000"
